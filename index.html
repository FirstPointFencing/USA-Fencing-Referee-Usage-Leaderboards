<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USA Fencing Referee Commission Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .controls {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }

        .control-group {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        select, input, button {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stats-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stats-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }

        .tabs {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .tab-buttons {
            display: flex;
            background: rgba(102, 126, 234, 0.1);
            flex-wrap: wrap;
        }

        .tab-button {
            padding: 15px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-weight: 600;
            color: #2c3e50;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-content {
            padding: 20px;
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            cursor: pointer;
            user-select: none;
        }

        th:hover {
            opacity: 0.9;
        }

        tr:hover {
            background-color: rgba(102, 126, 234, 0.05);
        }

        .weapon-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin: 2px;
            color: white;
            font-weight: 600;
        }

        .weapon-MF { background: #e74c3c; }
        .weapon-WF { background: #ec7063; }
        .weapon-ME { background: #2ecc71; }
        .weapon-WE { background: #58d68d; }
        .weapon-MS { background: #f39c12; }
        .weapon-WS { background: #f8c471; }

        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }

        .sort-arrow {
            float: right;
            opacity: 0.5;
        }

        .sort-arrow.active {
            opacity: 1;
        }

        #fileInput {
            display: none;
        }

        .file-upload-btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        .info-message {
            background: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #3498db;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ü§∫ USA Fencing Referee Commission Dashboard</h1>
        <p>Comprehensive Referee Usage Analysis & Tracking System</p>
    </div>

    <div class="container">
        <div class="controls">
            <div class="control-group">
                <label>Upload CSV Files:</label>
                <input type="file" id="fileInput" multiple accept=".csv">
                <button class="file-upload-btn" onclick="document.getElementById('fileInput').click()">
                    üìÅ Select CSV Files
                </button>
                <button onclick="loadSampleData()">üìä Load Sample Data</button>
            </div>
            <div class="control-group">
                <label>Season:</label>
                <select id="seasonFilter">
                    <option value="all">All Seasons</option>
                </select>
                <label>Tournament:</label>
                <select id="tournamentFilter">
                    <option value="all">All Tournaments</option>
                </select>
                <label>Weapon:</label>
                <select id="weaponFilter">
                    <option value="all">All Weapons</option>
                    <option value="MF">Men's Foil</option>
                    <option value="WF">Women's Foil</option>
                    <option value="ME">Men's Epee</option>
                    <option value="WE">Women's Epee</option>
                    <option value="MS">Men's Saber</option>
                    <option value="WS">Women's Saber</option>
                </select>
            </div>
        </div>

        <div class="dashboard-grid" id="statsGrid">
            <div class="stats-card">
                <h3>Total Referees</h3>
                <div class="stats-number" id="totalReferees">0</div>
            </div>
            <div class="stats-card">
                <h3>Total Matches</h3>
                <div class="stats-number" id="totalMatches">0</div>
            </div>
            <div class="stats-card">
                <h3>Total Finals</h3>
                <div class="stats-number" id="totalFinals">0</div>
            </div>
            <div class="stats-card">
                <h3>Active Tournaments</h3>
                <div class="stats-number" id="activeTournaments">0</div>
            </div>
        </div>

        <div class="tabs">
            <div class="tab-buttons">
                <button class="tab-button active" onclick="showTab('overview')">Overview</button>
                <button class="tab-button" onclick="showTab('rankings')">Referee Rankings</button>
                <button class="tab-button" onclick="showTab('weapons')">Weapon Analysis</button>
                <button class="tab-button" onclick="showTab('tournaments')">Tournament Details</button>
                <button class="tab-button" onclick="showTab('seasons')">Season Summary</button>
                <button class="tab-button" onclick="showTab('video')">Video Referee Stats</button>
                <button class="tab-button" onclick="showTab('finals')">Finals Leaderboard</button>
            </div>

            <div class="tab-content active" id="overview">
                <h2>System Overview</h2>
                <div class="info-message">
                    <p>Welcome to the USA Fencing Referee Commission Dashboard. This system provides:</p>
                    <ul style="margin: 10px 0 0 20px;">
                        <li>Complete referee usage tracking across all tournaments and seasons</li>
                        <li>Weapon-specific statistics for all six fencing disciplines</li>
                        <li>Video referee assignment analysis</li>
                        <li>Pool and elimination round breakdown</li>
                        <li>Finals assignment tracking</li>
                        <li>Tournament and season aggregations</li>
                    </ul>
                    <p style="margin-top: 10px;">Upload your CSV files or load sample data to begin analysis.</p>
                </div>
            </div>

            <div class="tab-content" id="rankings">
                <h2>Referee Rankings</h2>
                <table id="rankingsTable">
                    <thead>
                        <tr>
                            <th onclick="sortTable('rankingsTable', 0)">Rank <span class="sort-arrow">‚Üï</span></th>
                            <th onclick="sortTable('rankingsTable', 1)">Name <span class="sort-arrow">‚Üï</span></th>
                            <th onclick="sortTable('rankingsTable', 2)">Total Matches <span class="sort-arrow">‚Üï</span></th>
                            <th onclick="sortTable('rankingsTable', 3)">Video Ref <span class="sort-arrow">‚Üï</span></th>
                            <th onclick="sortTable('rankingsTable', 4)">Video % <span class="sort-arrow">‚Üï</span></th>
                            <th onclick="sortTable('rankingsTable', 5)">Finals <span class="sort-arrow">‚Üï</span></th>
                            <th onclick="sortTable('rankingsTable', 6)">Pools <span class="sort-arrow">‚Üï</span></th>
                            <th onclick="sortTable('rankingsTable', 7)">Events <span class="sort-arrow">‚Üï</span></th>
                            <th onclick="sortTable('rankingsTable', 8)">Tournaments <span class="sort-arrow">‚Üï</span></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <div class="tab-content" id="weapons">
                <h2>Weapon-Specific Analysis</h2>
                <div id="weaponTables"></div>
            </div>

            <div class="tab-content" id="tournaments">
                <h2>Tournament Details</h2>
                <div id="tournamentDetails"></div>
            </div>

            <div class="tab-content" id="seasons">
                <h2>Season Summary</h2>
                <div id="seasonSummary"></div>
            </div>

            <div class="tab-content" id="video">
                <h2>Video Referee Statistics</h2>
                <table id="videoTable">
                    <thead>
                        <tr>
                            <th onclick="sortTable('videoTable', 0)">Rank <span class="sort-arrow">‚Üï</span></th>
                            <th onclick="sortTable('videoTable', 1)">Name <span class="sort-arrow">‚Üï</span></th>
                            <th onclick="sortTable('videoTable', 2)">Video Matches <span class="sort-arrow">‚Üï</span></th>
                            <th onclick="sortTable('videoTable', 3)">Video Finals <span class="sort-arrow">‚Üï</span></th>
                            <th onclick="sortTable('videoTable', 4)">Video % of Total <span class="sort-arrow">‚Üï</span></th>
                            <th onclick="sortTable('videoTable', 5)">Tournaments <span class="sort-arrow">‚Üï</span></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>

            <div class="tab-content" id="finals">
                <h2>Finals Leaderboard</h2>
                <table id="finalsTable">
                    <thead>
                        <tr>
                            <th onclick="sortTable('finalsTable', 0)">Rank <span class="sort-arrow">‚Üï</span></th>
                            <th onclick="sortTable('finalsTable', 1)">Name <span class="sort-arrow">‚Üï</span></th>
                            <th onclick="sortTable('finalsTable', 2)">Total Finals <span class="sort-arrow">‚Üï</span></th>
                            <th onclick="sortTable('finalsTable', 3)">As Referee <span class="sort-arrow">‚Üï</span></th>
                            <th onclick="sortTable('finalsTable', 4)">As Video <span class="sort-arrow">‚Üï</span></th>
                            <th onclick="sortTable('finalsTable', 5)">Weapons <span class="sort-arrow">‚Üï</span></th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Tournament date mappings
        const tournamentDates = {
            '2024-2025': {
                'October NAC': { start: '2024-10-04', end: '2024-10-07' },
                'November NAC': { start: '2024-11-08', end: '2024-11-11' },
                'December SJCC': { start: '2024-12-06', end: '2024-12-08' },
                'January NAC': { start: '2025-01-03', end: '2025-01-06' },
                'February JO': { start: '2025-02-14', end: '2025-02-17' },
                'March NAC': { start: '2025-03-06', end: '2025-03-11' },
                'April NAC': { start: '2025-04-11', end: '2025-04-13' },
                'May SJCC': { start: '2025-05-15', end: '2025-05-19' },
                'Summer Nationals': { start: '2025-06-27', end: '2025-07-06' }
            },
            '2023-2024': {
                'October NAC': { start: '2023-10-26', end: '2023-10-29' },
                'November NAC': { start: '2023-11-10', end: '2023-11-13' },
                'December SJCC': { start: '2023-12-01', end: '2023-12-04' },
                'January NAC': { start: '2024-01-05', end: '2024-01-08' },
                'February JO': { start: '2024-02-16', end: '2024-02-19' },
                'March NAC': { start: '2024-03-01', end: '2024-03-04' },
                'March SJCC': { start: '2024-03-15', end: '2024-03-17' },
                'April NAC': { start: '2024-04-25', end: '2024-04-28' },
                'Summer Nationals': { start: '2024-06-30', end: '2024-07-08' }
            },
            '2022-2023': {
                'October NAC': { start: '2022-10-07', end: '2022-10-10' },
                'December NAC': { start: '2022-12-09', end: '2022-12-12' },
                'January NAC': { start: '2023-01-06', end: '2023-01-09' },
                'February JO': { start: '2023-02-17', end: '2023-02-20' },
                'March NAC': { start: '2023-03-03', end: '2023-03-06' },
                'April NAC': { start: '2023-04-21', end: '2023-04-24' },
                'June SJCC': { start: '2023-06-02', end: '2023-06-04' },
                'Summer Nationals': { start: '2023-06-30', end: '2023-07-09' }
            },
            '2021-2022': {
                'March NAC': { start: '2022-03-04', end: '2022-03-07' },
                'April NAC': { start: '2022-04-21', end: '2022-04-24' },
                'Summer Nationals': { start: '2022-07-02', end: '2022-07-11' }
            }
        };

        // Global data storage
        let allData = [];
        let filteredData = [];
        let refereeStats = {};

        // File input handler
        document.getElementById('fileInput').addEventListener('change', function(event) {
            const files = event.target.files;
            if (files.length > 0) {
                handleFileUpload(files);
            }
        });

        function handleFileUpload(files) {
            allData = [];
            const promises = [];
            
            for (let file of files) {
                promises.push(parseCSV(file));
            }
            
            Promise.all(promises).then(results => {
                allData = results.flat();
                processData();
            });
        }

        function parseCSV(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const csv = e.target.result;
                    const lines = csv.split('\n');
                    const headers = lines[0].split(',').map(h => h.trim());
                    const data = [];
                    
                    for (let i = 1; i < lines.length; i++) {
                        if (lines[i].trim()) {
                            const values = lines[i].split(',');
                            const row = {};
                            headers.forEach((header, index) => {
                                row[header] = values[index] ? values[index].trim() : '';
                            });
                            data.push(row);
                        }
                    }
                    resolve(data);
                };
                reader.readAsText(file);
            });
        }

        function processData() {
            // Process referee statistics
            refereeStats = {};
            
            allData.forEach(row => {
                const name = row['Name'] || `${row['Last Name']} ${row['First Name']}`.trim();
                if (!name || name === ' ') return;
                
                if (!refereeStats[name]) {
                    refereeStats[name] = {
                        name: name,
                        totalMatches: 0,
                        videoMatches: 0,
                        finals: 0,
                        videoFinals: 0,
                        pools: 0,
                        events: new Set(),
                        tournaments: new Set(),
                        weapons: new Set(),
                        seasons: new Set()
                    };
                }
                
                // Determine season and tournament
                const date = row['Date'];
                const season = determineSeasonFromDate(date);
                const tournament = determineTournamentFromDate(date, season);
                
                // Parse event for weapon
                const event = row['Event'] || row['Division'];
                const weapon = parseWeaponFromEvent(event);
                
                // Count matches
                const poolCount = parsePoolCount(row);
                refereeStats[name].pools += poolCount;
                refereeStats[name].totalMatches += poolCount;
                
                // Count elimination rounds
                const elimRounds = ['Table of 512', 'Table of 256', 'Table of 128', 'Table of 64', 
                                   'Table of 32', 'Table of 16', 'Table of 8', 'Semi-Finals', 
                                   'Bronze Medal Matches', 'Fence-off for Third'];
                
                elimRounds.forEach(round => {
                    const count = parseMatchCount(row[round]);
                    refereeStats[name].totalMatches += count.ref;
                    refereeStats[name].videoMatches += count.video;
                });
                
                // Count finals
                const finalsCount = parseMatchCount(row['Finals']);
                refereeStats[name].finals += finalsCount.ref;
                refereeStats[name].videoFinals += finalsCount.video;
                refereeStats[name].totalMatches += finalsCount.ref;
                refereeStats[name].videoMatches += finalsCount.video;
                
                // Track unique values
                if (event) refereeStats[name].events.add(event);
                if (tournament) refereeStats[name].tournaments.add(tournament);
                if (weapon) refereeStats[name].weapons.add(weapon);
                if (season) refereeStats[name].seasons.add(season);
            });
            
            updateDashboard();
        }

        function parsePoolCount(row) {
            let total = 0;
            ['Pools', 'Pool 1', 'Pool 2'].forEach(col => {
                if (row[col]) {
                    const match = row[col].match(/Ref:\s*(\d+)/);
                    if (match) {
                        total += parseInt(match[1]);
                    } else if (!isNaN(row[col])) {
                        total += parseInt(row[col]);
                    }
                }
            });
            return total;
        }

        function parseMatchCount(value) {
            const result = { ref: 0, video: 0 };
            if (!value) return result;
            
            const refMatch = value.match(/Ref:\s*(\d+)/);
            const videoMatch = value.match(/Video:\s*(\d+)/);
            
            if (refMatch) result.ref = parseInt(refMatch[1]);
            if (videoMatch) result.video = parseInt(videoMatch[1]);
            
            // If no pattern, try parsing as number
            if (!refMatch && !videoMatch && !isNaN(value)) {
                result.ref = parseInt(value);
            }
            
            return result;
        }

        function parseWeaponFromEvent(event) {
            if (!event) return null;
            
            const weaponMap = {
                'MS': 'Men\'s Saber',
                'WS': 'Women\'s Saber',
                'ME': 'Men\'s Epee',
                'WE': 'Women\'s Epee',
                'MF': 'Men\'s Foil',
                'WF': 'Women\'s Foil'
            };
            
            for (let code in weaponMap) {
                if (event.includes(code)) return code;
            }
            return null;
        }

        function determineSeasonFromDate(dateStr) {
            if (!dateStr) return 'Unknown';
            
            const date = new Date(dateStr);
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            
            // Season runs from August to July
            if (month >= 8) {
                return `${year}-${year + 1}`;
            } else {
                return `${year - 1}-${year}`;
            }
        }

        function determineTournamentFromDate(dateStr, season) {
            if (!dateStr || !season || season === 'Unknown') return 'Unknown';
            
            const date = new Date(dateStr);
            const tournaments = tournamentDates[season];
            
            if (!tournaments) {
                // Fallback to month-based naming
                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                                   'July', 'August', 'September', 'October', 'November', 'December'];
                return `${monthNames[date.getMonth()]} National`;
            }
            
            for (let tournament in tournaments) {
                const start = new Date(tournaments[tournament].start);
                const end = new Date(tournaments[tournament].end);
                if (date >= start && date <= end) {
                    return tournament;
                }
            }
            
            // Fallback to month-based naming
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                               'July', 'August', 'September', 'October', 'November', 'December'];
            return `${monthNames[date.getMonth()]} National`;
        }

        function updateDashboard() {
            // Update stats cards
            const refs = Object.keys(refereeStats);
            document.getElementById('totalReferees').textContent = refs.length;
            
            let totalMatches = 0;
            let totalFinals = 0;
            let tournaments = new Set();
            
            refs.forEach(ref => {
                totalMatches += refereeStats[ref].totalMatches;
                totalFinals += refereeStats[ref].finals + refereeStats[ref].videoFinals;
                refereeStats[ref].tournaments.forEach(t => tournaments.add(t));
            });
            
            document.getElementById('totalMatches').textContent = totalMatches;
            document.getElementById('totalFinals').textContent = totalFinals;
            document.getElementById('activeTournaments').textContent = tournaments.size;
            
            // Update filter dropdowns
            updateFilters();
            
            // Update tables
            updateRankingsTable();
            updateVideoTable();
            updateFinalsTable();
            updateWeaponTables();
            updateTournamentDetails();
            updateSeasonSummary();
        }

        function updateFilters() {
            const seasons = new Set();
            const tournaments = new Set();
            
            Object.values(refereeStats).forEach(ref => {
                ref.seasons.forEach(s => seasons.add(s));
                ref.tournaments.forEach(t => tournaments.add(t));
            });
            
            // Update season filter
            const seasonFilter = document.getElementById('seasonFilter');
            seasonFilter.innerHTML = '<option value="all">All Seasons</option>';
            Array.from(seasons).sort().reverse().forEach(season => {
                seasonFilter.innerHTML += `<option value="${season}">${season}</option>`;
            });
            
            // Update tournament filter
            const tournamentFilter = document.getElementById('tournamentFilter');
            tournamentFilter.innerHTML = '<option value="all">All Tournaments</option>';
            Array.from(tournaments).sort().forEach(tournament => {
                tournamentFilter.innerHTML += `<option value="${tournament}">${tournament}</option>`;
            });
        }

        function updateRankingsTable() {
            const tbody = document.querySelector('#rankingsTable tbody');
            tbody.innerHTML = '';
            
            const refs = Object.values(refereeStats).sort((a, b) => b.totalMatches - a.totalMatches);
            
            refs.forEach((ref, index) => {
                const videoPercent = ref.totalMatches > 0 ? 
                    ((ref.videoMatches / ref.totalMatches) * 100).toFixed(1) : 0;
                
                tbody.innerHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${ref.name}</td>
                        <td>${ref.totalMatches}</td>
                        <td>${ref.videoMatches}</td>
                        <td>${videoPercent}%</td>
                        <td>${ref.finals}</td>
                        <td>${ref.pools}</td>
                        <td>${ref.events.size}</td>
                        <td>${ref.tournaments.size}</td>
                    </tr>
                `;
            });
        }

        function updateVideoTable() {
            const tbody = document.querySelector('#videoTable tbody');
            tbody.innerHTML = '';
            
            const refs = Object.values(refereeStats)
                .filter(ref => ref.videoMatches > 0)
                .sort((a, b) => b.videoMatches - a.videoMatches);
            
            refs.forEach((ref, index) => {
                const videoPercent = ref.totalMatches > 0 ? 
                    ((ref.videoMatches / ref.totalMatches) * 100).toFixed(1) : 0;
                
                tbody.innerHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${ref.name}</td>
                        <td>${ref.videoMatches}</td>
                        <td>${ref.videoFinals}</td>
                        <td>${videoPercent}%</td>
                        <td>${ref.tournaments.size}</td>
                    </tr>
                `;
            });
        }

        function updateFinalsTable() {
            const tbody = document.querySelector('#finalsTable tbody');
            tbody.innerHTML = '';
            
            const refs = Object.values(refereeStats)
                .filter(ref => (ref.finals + ref.videoFinals) > 0)
                .sort((a, b) => (b.finals + b.videoFinals) - (a.finals + a.videoFinals));
            
            refs.forEach((ref, index) => {
                const totalFinals = ref.finals + ref.videoFinals;
                const weaponBadges = Array.from(ref.weapons).map(w => 
                    `<span class="weapon-badge weapon-${w}">${w}</span>`
                ).join('');
                
                tbody.innerHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${ref.name}</td>
                        <td>${totalFinals}</td>
                        <td>${ref.finals}</td>
                        <td>${ref.videoFinals}</td>
                        <td>${weaponBadges}</td>
                    </tr>
                `;
            });
        }

        function updateWeaponTables() {
            const container = document.getElementById('weaponTables');
            container.innerHTML = '';
            
            const weapons = ['MF', 'WF', 'ME', 'WE', 'MS', 'WS'];
            const weaponNames = {
                'MF': "Men's Foil",
                'WF': "Women's Foil",
                'ME': "Men's Epee",
                'WE': "Women's Epee",
                'MS': "Men's Saber",
                'WS': "Women's Saber"
            };
            
            weapons.forEach(weapon => {
                const weaponRefs = Object.values(refereeStats)
                    .filter(ref => ref.weapons.has(weapon))
                    .sort((a, b) => b.totalMatches - a.totalMatches);
                
                if (weaponRefs.length > 0) {
                    container.innerHTML += `
                        <h3>${weaponNames[weapon]}</h3>
                        <table>
                            <thead>
                                <tr>
                                    <th>Rank</th>
                                    <th>Name</th>
                                    <th>Matches</th>
                                    <th>Finals</th>
                                    <th>Video %</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${weaponRefs.slice(0, 10).map((ref, index) => `
                                    <tr>
                                        <td>${index + 1}</td>
                                        <td>${ref.name}</td>
                                        <td>${ref.totalMatches}</td>
                                        <td>${ref.finals + ref.videoFinals}</td>
                                        <td>${ref.totalMatches > 0 ? ((ref.videoMatches / ref.totalMatches) * 100).toFixed(1) : 0}%</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                }
            });
        }

        function updateTournamentDetails() {
            const container = document.getElementById('tournamentDetails');
            container.innerHTML = '';
            
            const tournaments = {};
            
            Object.values(refereeStats).forEach(ref => {
                ref.tournaments.forEach(tournament => {
                    if (!tournaments[tournament]) {
                        tournaments[tournament] = {
                            referees: [],
                            totalMatches: 0,
                            totalFinals: 0
                        };
                    }
                    tournaments[tournament].referees.push(ref);
                    tournaments[tournament].totalMatches += ref.totalMatches;
                    tournaments[tournament].totalFinals += ref.finals + ref.videoFinals;
                });
            });
            
            Object.keys(tournaments).sort().forEach(tournament => {
                const data = tournaments[tournament];
                container.innerHTML += `
                    <h3>${tournament}</h3>
                    <p>Total Referees: ${data.referees.length} | Total Matches: ${data.totalMatches} | Total Finals: ${data.totalFinals}</p>
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Matches</th>
                                <th>Video</th>
                                <th>Finals</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${data.referees.sort((a, b) => b.totalMatches - a.totalMatches).slice(0, 10).map(ref => `
                                <tr>
                                    <td>${ref.name}</td>
                                    <td>${ref.totalMatches}</td>
                                    <td>${ref.videoMatches}</td>
                                    <td>${ref.finals + ref.videoFinals}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            });
        }

        function updateSeasonSummary() {
            const container = document.getElementById('seasonSummary');
            container.innerHTML = '';
            
            const seasons = {};
            
            Object.values(refereeStats).forEach(ref => {
                ref.seasons.forEach(season => {
                    if (!seasons[season]) {
                        seasons[season] = {
                            referees: new Set(),
                            totalMatches: 0,
                            totalFinals: 0,
                            tournaments: new Set()
                        };
                    }
                    seasons[season].referees.add(ref.name);
                    seasons[season].totalMatches += ref.totalMatches;
                    seasons[season].totalFinals += ref.finals + ref.videoFinals;
                    ref.tournaments.forEach(t => seasons[season].tournaments.add(t));
                });
            });
            
            Object.keys(seasons).sort().reverse().forEach(season => {
                const data = seasons[season];
                container.innerHTML += `
                    <h3>${season} Season</h3>
                    <p>
                        Referees: ${data.referees.size} | 
                        Tournaments: ${data.tournaments.size} | 
                        Total Matches: ${data.totalMatches} | 
                        Total Finals: ${data.totalFinals}
                    </p>
                `;
            });
        }

        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function sortTable(tableId, columnIndex) {
            const table = document.getElementById(tableId);
            const tbody = table.querySelector('tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            // Determine sort direction
            const th = table.querySelectorAll('th')[columnIndex];
            const isAscending = th.classList.contains('asc');
            
            // Clear all sort indicators
            table.querySelectorAll('th').forEach(header => {
                header.classList.remove('asc', 'desc');
            });
            
            // Sort rows
            rows.sort((a, b) => {
                const aValue = a.cells[columnIndex].textContent.replace('%', '');
                const bValue = b.cells[columnIndex].textContent.replace('%', '');
                
                // Check if numeric
                if (!isNaN(aValue) && !isNaN(bValue)) {
                    return isAscending ? 
                        parseFloat(bValue) - parseFloat(aValue) : 
                        parseFloat(aValue) - parseFloat(bValue);
                }
                
                // String comparison
                return isAscending ? 
                    bValue.localeCompare(aValue) : 
                    aValue.localeCompare(bValue);
            });
            
            // Set new sort direction
            th.classList.add(isAscending ? 'desc' : 'asc');
            
            // Re-append sorted rows
            rows.forEach(row => tbody.appendChild(row));
        }

        function loadSampleData() {
            // Sample data for demonstration
            const sampleData = [
                {
                    'Name': 'John Smith',
                    'Date': '2024-10-05',
                    'Event': 'Y14 MF',
                    'Pool 1': 'Ref: 6',
                    'Pool 2': 'Ref: 4',
                    'Table of 128': 'Ref: 2',
                    'Table of 64': 'Ref: 1',
                    'Table of 32': 'Video: 1',
                    'Table of 16': 'Ref: 1',
                    'Table of 8': 'Video: 1',
                    'Semi-Finals': 'Ref: 1',
                    'Finals': 'Ref: 1'
                },
                {
                    'Name': 'Jane Doe',
                    'Date': '2024-11-09',
                    'Event': 'CDT WE',
                    'Pool 1': 'Ref: 8',
                    'Table of 64': 'Ref: 2',
                    'Table of 32': 'Ref: 2',
                    'Table of 16': 'Video: 2',
                    'Table of 8': 'Ref: 1',
                    'Finals': 'Video: 1'
                },
                {
                    'Name': 'Michael Chen',
                    'Date': '2024-12-07',
                    'Event': 'Jr MS',
                    'Pool 1': 'Ref: 5',
                    'Pool 2': 'Ref: 5',
                    'Table of 128': 'Ref: 3',
                    'Table of 64': 'Video: 2',
                    'Table of 32': 'Ref: 2',
                    'Table of 16': 'Ref: 2',
                    'Table of 8': 'Video: 1',
                    'Semi-Finals': 'Video: 1',
                    'Finals': 'Ref: 1'
                },
                {
                    'Name': 'Sarah Johnson',
                    'Date': '2025-01-04',
                    'Event': 'Sr WF',
                    'Pool 1': 'Ref: 7',
                    'Table of 256': 'Ref: 1',
                    'Table of 128': 'Ref: 2',
                    'Table of 64': 'Ref: 3',
                    'Table of 32': 'Video: 2',
                    'Table of 16': 'Ref: 1',
                    'Finals': 'Video: 1'
                },
                {
                    'Name': 'Robert Lee',
                    'Date': '2025-02-15',
                    'Event': 'CDT ME',
                    'Pool 1': 'Ref: 6',
                    'Pool 2': 'Ref: 3',
                    'Table of 128': 'Video: 2',
                    'Table of 64': 'Ref: 2',
                    'Table of 32': 'Ref: 1',
                    'Table of 16': 'Video: 1',
                    'Table of 8': 'Ref: 1',
                    'Semi-Finals': 'Ref: 1'
                }
            ];
            
            // Generate more sample data
            const names = ['John Smith', 'Jane Doe', 'Michael Chen', 'Sarah Johnson', 'Robert Lee',
                          'Emily Wang', 'David Martinez', 'Lisa Anderson', 'James Wilson', 'Maria Garcia'];
            const events = ['Y10 MF', 'Y10 WF', 'Y12 ME', 'Y12 WE', 'Y14 MS', 'Y14 WS',
                           'CDT MF', 'CDT WF', 'Jr ME', 'Jr WE', 'Sr MS', 'Sr WS'];
            
            for (let i = 0; i < 100; i++) {
                const name = names[Math.floor(Math.random() * names.length)];
                const event = events[Math.floor(Math.random() * events.length)];
                const month = Math.floor(Math.random() * 8) + 10; // October to May
                const year = month >= 10 ? 2024 : 2025;
                const day = Math.floor(Math.random() * 20) + 5;
                
                sampleData.push({
                    'Name': name,
                    'Date': `${year}-${String(month % 12 || 12).padStart(2, '0')}-${String(day).padStart(2, '0')}`,
                    'Event': event,
                    'Pool 1': Math.random() > 0.3 ? `Ref: ${Math.floor(Math.random() * 8) + 1}` : '',
                    'Pool 2': Math.random() > 0.7 ? `Ref: ${Math.floor(Math.random() * 4) + 1}` : '',
                    'Table of 128': Math.random() > 0.5 ? (Math.random() > 0.7 ? `Video: ${Math.floor(Math.random() * 2) + 1}` : `Ref: ${Math.floor(Math.random() * 3) + 1}`) : '',
                    'Table of 64': Math.random() > 0.6 ? (Math.random() > 0.8 ? `Video: ${Math.floor(Math.random() * 2) + 1}` : `Ref: ${Math.floor(Math.random() * 2) + 1}`) : '',
                    'Table of 32': Math.random() > 0.7 ? (Math.random() > 0.8 ? `Video: 1` : `Ref: 1`) : '',
                    'Table of 16': Math.random() > 0.8 ? (Math.random() > 0.7 ? `Video: 1` : `Ref: 1`) : '',
                    'Table of 8': Math.random() > 0.85 ? (Math.random() > 0.6 ? `Video: 1` : `Ref: 1`) : '',
                    'Semi-Finals': Math.random() > 0.9 ? (Math.random() > 0.5 ? `Video: 1` : `Ref: 1`) : '',
                    'Finals': Math.random() > 0.95 ? (Math.random() > 0.4 ? `Video: 1` : `Ref: 1`) : ''
                });
            }
            
            allData = sampleData;
            processData();
            
            // Show success message
            const infoMessage = document.querySelector('.info-message');
            infoMessage.innerHTML = '<p style="color: #27ae60; font-weight: bold;">‚úì Sample data loaded successfully! Explore the different tabs to see referee statistics.</p>';
        }

        // Filter event listeners
        document.getElementById('seasonFilter').addEventListener('change', applyFilters);
        document.getElementById('tournamentFilter').addEventListener('change', applyFilters);
        document.getElementById('weaponFilter').addEventListener('change', applyFilters);

        function applyFilters() {
            const season = document.getElementById('seasonFilter').value;
            const tournament = document.getElementById('tournamentFilter').value;
            const weapon = document.getElementById('weaponFilter').value;
            
            // Filter data based on selections
            filteredData = allData.filter(row => {
                let include = true;
                
                if (season !== 'all') {
                    const rowSeason = determineSeasonFromDate(row['Date']);
                    if (rowSeason !== season) include = false;
                }
                
                if (tournament !== 'all') {
                    const rowSeason = determineSeasonFromDate(row['Date']);
                    const rowTournament = determineTournamentFromDate(row['Date'], rowSeason);
                    if (rowTournament !== tournament) include = false;
                }
                
                if (weapon !== 'all') {
                    const event = row['Event'] || row['Division'];
                    const rowWeapon = parseWeaponFromEvent(event);
                    if (rowWeapon !== weapon) include = false;
                }
                
                return include;
            });
            
            // Reprocess with filtered data
            if (filteredData.length > 0) {
                const tempData = allData;
                allData = filteredData;
                processData();
                allData = tempData;
            }
        }

        // Initialize with sample data prompt
        window.onload = function() {
            document.querySelector('.info-message').innerHTML += 
                '<p style="margin-top: 10px;"><strong>Quick Start:</strong> Click "Load Sample Data" to see the dashboard in action with example referee data.</p>';
        };
    </script>
</body>
</html>